<!DOCTYPE html>
<html lang="en" 
      xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Bus Pass Management Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
          rel="stylesheet" 
          crossorigin="anonymous">
</head>
<body>

<div class="container mt-5">
    
    <!-- Header and Welcome -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="display-6">
            Welcome, 
            <span sec:authentication="name" class="text-primary">User</span>! 
        </h1>
        <div class="text-end">
            <!-- Display the user's current role -->
            <span class="badge bg-secondary me-3">
                Role: <span sec:authentication="authorities">ROLE</span>
            </span>
            <a th:href="@{/logout}" class="btn btn-outline-danger">Logout</a>
        </div>
    </div>
    
    <hr/>
    
    <!-- Success/Error Messages -->
    <div th:if="${successMessage}" class="alert alert-success" role="alert">
        <span th:text="${successMessage}"></span>
    </div>
    <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
        <span th:text="${errorMessage}"></span>
    </div>

    <!-- MAIN DASHBOARD CONTENT -->
    <div class="row g-4 mt-3">

        <!-- CARD 1: USER/STUDENT ACTIONS (Visible to ROLE_USER) -->
        <div sec:authorize="hasAuthority('ROLE_USER')" class="col-md-6 col-lg-4">
            <div class="card h-100 border-success shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-success">My Pass & Payments</h5>
                    <p class="card-text">View your digital bus pass, assigned route, and manage installment fees.</p>
                    <div class="mt-auto">
                        <a th:href="@{/pass}" class="btn btn-success w-100 mb-2 shadow-sm">View My Bus Pass</a>
                        <a th:href="@{/buses}" class="btn btn-outline-success w-100 mb-2">View Bus Routes</a>
                        <a th:href="@{/payments}" class="btn btn-outline-success w-100">View & Pay Installments</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW CARD: LIVE BUS TRACKING (Visible to USER and ADMIN) -->
        <div sec:authorize="hasAnyAuthority('ROLE_USER', 'ROLE_ADMIN')" class="col-md-6 col-lg-4">
            <div class="card h-100 border-info shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-info">Live Bus Tracking</h5>
                    <p class="card-text">Get real-time location updates for buses currently in service.</p>
                    <div class="mt-auto">
                        <a th:href="@{/track}" class="btn btn-info text-white w-100">Track Your Bus</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- DRIVER/ADMIN ACTIONS (Visible to DRIVER & ADMIN) -->
        <div sec:authorize="hasAnyAuthority('ROLE_ADMIN', 'ROLE_DRIVER')" class="col-md-6 col-lg-4">
            <div class="card h-100 border-warning shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-warning">Post Notices</h5>
                    <p class="card-text">Send urgent updates (delays, schedule changes) to all students.</p>
                    <div class="mt-auto">
                        <a th:href="@{/notices/add}" class="btn btn-warning w-100">Post New Notice</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADMIN MANAGEMENT TOOLS (Visible only to ADMIN) -->
        <div sec:authorize="hasAuthority('ROLE_ADMIN')" class="col-md-6 col-lg-4">
            <div class="card h-100 border-danger shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-danger">Administrator Tools</h5>
                    <p class="card-text">Manage users, define bus routes, and set payment due dates.</p>
                    <div class="mt-auto">
                        <a th:href="@{/buses}" class="btn btn-outline-danger w-100 mb-2">Manage Buses & Routes</a>
                        <a th:href="@{/payments}" class="btn btn-danger w-100">Manage All Payments</a>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- NOTICES FEED (Link is visible to everyone, but /notices only works for certain roles) -->
    <div class="mt-5">
        <h3 class="border-bottom pb-2">Latest Notifications</h3>
        <p class="text-muted">Access the feed for critical updates. Viewable by Students and Administrators.</p>
        <a th:href="@{/notices}" class="btn btn-info">View All Notices Feed</a>
    </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
        crossorigin="anonymous">
</script>
</body>
</html>
